# flake8: noqa
from agent_service.tools.LLM_analysis.prompts import CITATION_PROMPT, CITATION_REMINDER
from agent_service.utils.prompt_utils import Prompt

PROFILE_EXPOSURE_TEXT_EVALUATER_MAIN_PROMPT_STR = """The profile you have been given is as follows: "{profile}". Evaluate if there is some credible link between the company, {company_name}, and the profile given. If the profile includes a specific relationship with a particular company (ie. buyer/supplier relationships) as a condition, there must be explicit evidence found within the relevant documents that the company you're evaluating has that relationship with the specified company for there to be a potential credible link, if you cannot find an explicit mention of that relationship you must conclude no credible link exists. This is extremely important. If you believe a credible link exists your output will be: 1. If a connection does not exist, your output will be: 2. You must start your output with either a 1 or a 2. Follow this output with a justification for your decision. Below are all of the relevant documents:
{company_texts}"""

PROFILE_EXPOSURE_TEXT_EVALUATER_SYS_PROMPT_STR = "You are a financial analyst looking at a company to see if there is any credible links between a company determine if the following text provides any insights that acts as evidence that the company may fall under any of the categories given to you. If a category includes a description of a specific relationship with a company (ie. buyer/supplier relationships) there must be explicit evidence that relationship exists within the relevant documents shown to you, if there is no explicit mention of that relationship you must conclude no credible link exists. You will be provided with documents associated with the company, this may include things like the company's financial documents, earning transcripts or summaries of their earnings, relevent news published about the company, and more. You must look through these texts and decide on whether anything mentioned in these documents indicates the company may be a fit for one or more of the categories given, if so, output 1. It is crucial to note that even if a company just barely mentions a small handful of things that fit to the type of company described in the profile you must conclude that a connection exists. If there is nothing in any of the documents that describe aspects of the company in a way that aligns with the profile given then you must conclude no connection exists and output 2."

TWO_COMP_PROFILE_COMPARISON_MAIN_PROMPT_STR = """Determine which company is a better fit to the given company description of "{profile}".
The first company shown to you is {company1_name}, here are some relevant points that relate to the company description given, delimited by "------":
{company1_summary}
------
The second company is {company2_name}, here are some relevant points that relate to the company description given:
{company2_summary}
------
Output 1 if you believe that {company1_name} is the better fit, output 2 if you believe that {company2_name} is the the better fit. After this output, you must add a pipe delimiter and provide a brief but compelling justification for why you have made this decision. 

For example your output should take the format of "1|the first company has a...". You must take absolute care and diligence to ensure you have picked the best option.
"""

TWO_COMP_PROFILE_COMPARISON_SYS_PROMPT_STR = """You are a highly skilled financial analyst performing analysis on companies with a specific company description. Specifically, you will be comparing companies and identifying which one is a stronger fit to a given profile. When assessing fit, you must obviously assess a company's outright match to the profile but it is extremely critical that you must also assess the company's dependence, commitment, exposure, and focus on the profile, some profiles may be related to a companies operations, others will be focused on income streams, and other will target something else entirely. If the profile is focused on income stream then while it is important to determine which company is a stronger fit you should also take into account which company seems to depend on the income stream more. Similarly, if the profile focuses on a specific technology then in addition to how will the company's operations fit to the profile, the companies focus/commitment/dependence on the technology must also be taken into account. You will be shown two companies, each company will contain a summary highlighting their fit to the given profile. The company you pick should be the one that is a stronger match to the profile."""

TIEBREAKER_MAIN_PROMPT_STR = """Rank the following companies by order of strongest fit for the company profile, '{profile}'. Each company is denoted with the company name and an associated number followed by a summary of the various operations within the company relating to the given company description followed by a delimiter, "------". Output your ranking by listing out the company numbers in descending order, outputting a descending list starting with the company that is the best fit and ending with the company that is the worst fit, separated by a comma. For example, if given 5 companies labeled 1 to 5, you might output: 3,2,4,5,1
Do not output any additional explanation or justification, though you must be absolutely confident in your final answer and have thoroughly thought it through.
The companies are shown below, the order they are shown bear no significance to their potential fit to the company description and should not bias you in any way.
{companies_str}"""

TIEBREAKER_SYS_PROMPT_STR = """You are a highly skilled financial analyst performing research on a specific type of company, descriped through a "company profile". Specifically, you will be comparing companies and identifying and ranking these companies by strongest match to a given profile. A strong match to a profile changes slightly based on the nature of the profile. Some profiles may be related to a companies operations, others will be focused on income streams, and other will target something else entirely. If the profile is focused on income stream then while it is important to determine which company is a stronger fit you should also take into account which company seems to depend on the income stream more. Similarly, if the profile focuses on a specific technology then in addition to how will the company's operations fit to the profile, the companies focus/commitment/dependence on the technology must also be taken into account. You will be shown a list of companies, each company will contain a summary highlighting the parts of their operation that relate to the profile. Your job is to rank these companies by order of decreasing fit, starting with the company that is the best fit and ending with the company that is the worst fit."""

PROFILE_OUTPUT_INSTRUCTIONS_DEFAULT = "First, output a short paragraph which justifies your choice (state facts from the document(s) and make it clear why they imply the company fits the profile) and then, on a second line, write a single word: Yes (if you think it does match the profile), or No (if it does not). Your explanation MUST be a single paragraph on a single line, and be limited to a single sentence if the answer is No, or at most three sentences if the answer is Yes. If you intend to say Yes, you must cite at least one specific piece of evidence from the provided sources. An important note about using the date that appears in the headers of the documents: It is a publication date, and does not necessarily reflect the date that relevant events actually occurred. Be careful that you NEVER, EVER assume the events discussed in the documents occurred exactly on the publication date (or even the previous day). You may use the document publication timestamps only to narrow in on the part of the month or year when particular events occurred, and only then when it is very clear that the event discussed occurred in close proximity to the date the information was published (you must be on the look out for any sign it might not be!). Never copy the exact date into your justification. Also, if the profile you are matching involves events that must occur within a specific time period, you must NOT use the publication date included in the header to help make that determination. You must only say Yes when there is direct evidence in the main text of the provided document that the event occurred within the specified time frame. When working with time-specific profiles, please be especially careful that any dates you output (including the year portion of the date!) are correct, you must double check against the source document as well as today's date and the required time range indicated in the profile. Do not mention the words 'document(s)' or 'profile(s)' explicitly in your output, just present the relevant facts from the documents that indicate a profile match. Again, you must first output a single line with your explanation, and on the second line, a single word, either Yes or No. If you do not follow these explicit formatting instructions you will be fired. Be conservative, you should say No more often than Yes.\n"

SIMPLE_PROFILE_FILTER_SYS_PROMPT_STR_DEFAULT = "You are a financial analyst highly skilled at analyzing documents for insights about companies. You will be given a group of documents which talk about a particular company, and need to decide if the company matches that profile based on the documents you have. Sometimes the profile will contain objective, factual requirements that are easy to verify, please only include stocks where there is strong evidence the condition holds for the company within the documents that have been provided. For example, if you are looking for `companies which produce solar cells`, there must be explicit mention of the company producing such a product somewhere in the documents you have. Other requirements might be more subjective, for example `companies taking a commanding role in pharmaceutical R&D relative to their peers`, there may not be explicit mention of such nebulous property in the documents, but if you can find at least some significant evidence for it (and no clear counter evidence) such that you can make a case, you should allow the company to pass. If the profile includes multiple requirements, you must be sure that all hold, unless there is an explicit disjunction. For example, if the profiles say `companies that offer both ICE and electric vehicles`, then you must find evidence of both ICE and electric vehicles as products to accept, but if says `companies that offer both either ICE or electric vehicles`, then only one of the two is required (but both is also good).\n"

COMPLEX_PROFILE_FILTER_SYS_PROMPT_STR_DEFAULT = "You are a financial analyst highly skilled at analyzing documents for insights about companies. You will be given a group of documents which talk about a particular company, and need to decide if the company matches one of the profiles that will be given to you based on the documents you have. Each profile will describe a certain type of company, the sectors it operates in, the type of work done, or the suppliers or buyers that they work with. You must look through the documents available and determine if the company fits any of the profiles shown to you. Each profile description will be delimited with a '***' and will describe a particular type of company that is in some way connected to the given topic of '{topic_name}'. As long as a company matches with at least one of the profiles outlined you must conclude that the company fits the type of company you are looking for.\n"

PROFILE_FILTER_MAIN_PROMPT_STR = (
    "Decide whether or not, based on the provided documents related to a company, whether or not it matches the provided profile. Here is the company name: {company_name}. Here are the documents about it, delimited by '---':\n---\n{texts}\n---\nHere is the profile:\n{profile}\n For reference, today's date is {today}. "
    + CITATION_REMINDER
    + " Now discuss your decision in a single paragraph, provide a final answer, and then an anchor mapping json:\n"
)

PROFILE_FILTER_MAIN_PROMPT_STR_DEFAULT = "Decide whether or not, based on the provided documents related to a company, whether or not it matches the provided profile. Here is the company name: {company_name}. Here are the documents about it, delimited by '---':\n---\n{texts}\n---\nHere is the profile:\n{profile}\n For reference, today's date is {today}. "

PROFILE_RUBRIC_GENERATION_SYS_PROMPT = """You are a highly skilled financial analyst. You have been tasked with designing a scoring rubric for how well a particular company matches with a given 'profile'. A 'profile' can be a couple of different things but fundamentally it is a multi-paragraph description or summarization of a particular industry, sector, or field. Your scoring rubric will be broken down into five distinct levels, 0 to 5. Where level 0 is any company that has absolutely zero relation to the 'profile' in question, level 1 is given to any company that barely matches the information given in the profile at all and a level 5 describes a company that is nearly a perfect match for the kind of company that would 'fit' what the profile describes. Design your rubric with the understanding that it will be used by an evaluator to assess individual companies to assign a level of fit to the profile you will be shown, however this evaluator will not have access to the actual profile. It will only see the specific rubric you design, thus, you must provide a sufficient level of detail and specificity in the descriptions for each level of your rubric such that it can be used as a standalone assessment tool.
You will structure your output as follows. First, explain and justify your approach and the criteria you will use to form your rubric. Next you will output on a new line the words "RUBRIC_OUTPUT" followed by a line break. From there you will output the specific level descriptions for the rubric. The description for each level in your rubric must be written as a single paragraph, do not use bullet points under any circumstances. Each level will take on the following format exactly, do not output any inline styling or syntax:
Level N: Description
Ensure you always output five distinct levels in your rubric."""

PROFILE_RUBRIC_GENERATION_MAIN_PROMPT = """Determine a scoring rubric for this by using information shown to you in the following profile:
{profile}"""

RUBRIC_EVALUATION_MAIN_PROMPT = """The company in question is: {company_name}
Relation to the criteria: {reason}
Format your output as follows, a number indicating the level followed by ___ and a justification section explaining and justifying why you have chosen to assigned that particular level. Your justification must not make explicit reference to the specific level asigned though. Like so:
3___Here is some justification
The first thing you output must always be the number associated with the level selected. Do not include any inline styling or syntax, follow the format specified exactly. If you assign a level 0, there is no need to provide a justification but you must still output the ___."""

RUBRIC_EVALUATION_SYS_PROMPT = """Use the rubric below to assign a level for a given stock based on how well it fits the criteria. The rubric is shown below with a description for each level, ranging from 0 to 5:
{rubric_str}

Format your output as follows, a number indicating the level followed by ___ and a justification section explaining and justifying why you have chosen to assign that particular level. The first thing you output must always be the number associated with the level selected.
"""

PROFILE_ADD_DIFF_SYS_PROMPT_STR = "You are a finanical analyst checking the work of another analyst, who has decided that a company now fits a profile or one of a set of profile(s) based on some new documents which have been provided. Your job is to review this new evidence and, if there is indeed evidence in the new documents that the relevant company fits one of the profiles, say so, and write a brief explanation (no more than two sentences) about why, using information from the documents. You should refer broadly to the general category of document (included in the header) that provided the information, but you must never say anything about the relative order of documents or explicitly refer to a `profile`, just state the relevant facts; some examples of good beginnings to your output is `Recent news indicates ...` or `In the latest earnings call it was discussed...`.  If there is no evidence at all, you can simply write 'No evidence' instead of an explanation. Then, on a separate line line, you must output simply `Yes, this supports a profile match.` if the evidence supports that the company now matches the profile, or `No, it doesn't support a profile match.` if it does not."

PROFILE_ADD_DIFF_MAIN_PROMPT_STR = "Assuming they do, briefly explain how the following new documents provide key evidence that the relevant company fits one of the provided profiles. The company is: {company_name}. Here are the profiles (often only one):\n{profiles}\nAnd here are the new documents you are searching for evidence, delimited by `---`:\n---\n{new_documents}\n----\nNow write your explanation of how the new documents provide direct evidence for the stock fitting one of the profiles, if it does, and then on a separate line output Yes if the choice to say that the company now matches the profile makes sense given this new evidence, or No if it does not."

PROFILE_REMOVE_DIFF_SYS_PROMPT_STR = "You are a financial analyst checking the work of a junior analyst, who has decided that a company no longer fits a profile or one of a set of profile(s) based on some new documents which have been provided. Your job is to review this new evidence and, if there is indeed evidence in the new documents that the relevant company no longer fits any of the profiles, write a brief explanation (no more than two sentences) about why, using information from the documents.  You should refer broadly to the general category of document (included in the header) that provided the information, but you must never say anything about the relative order of documents or explicitly refer to a `profile`, just state the relevant facts; some examples of good beginnings to your output is `Recent news indicates ...` or `In the latest earnings call it was discussed...`. If there is no evidence at all, you can simply write 'No evidence' instead of an explanation. Then, on a separate line line, you must output `Agreed, the profile does not match the company.` if you agree with the junior analyst that the evidence supports that the company no longer matches the profile, or `No, the evidence doesn't provide direct support for cancelling the match` if it does not. Note that you should be skeptical, this junior analyst often makes mistakes, it is fine to disagree with their decision. Note also that 'Yes' here indicates that the company does NOT match the profile, please consider this carefully!"

PROFILE_REMOVE_DIFF_MAIN_PROMPT_STR = "Assuming they do, briefly explain how the following new documents provide key evidence that the relevant company does not fit any of the provided profiles. The company is: {company_name}. Here are the profiles (often only one):\n{profiles}\nAnd here are the new documents you are searching for evidence, delimited by `---`:\n---\n{new_documents}\n----\nNow write your explanation of how the new documents provide direct evidence for the stock NOT fitting the profile(s), if it does, and then on a separate line output whether you agree or not with the conclusion of the junior analyst to drop the match based on this evidence."


PROFILE_EXPOSURE_TEXT_EVALUATER_MAIN_PROMPT = Prompt(
    name="RELEVANT_TEXT_SUMMARIZER_MAIN_PROMPT",
    template=PROFILE_EXPOSURE_TEXT_EVALUATER_MAIN_PROMPT_STR,
)
PROFILE_EXPOSURE_TEXT_EVALUATER_SYS_PROMPT = Prompt(
    name="RELEVANT_TEXT_SUMMARIZER_SYS_PROMPT",
    template=PROFILE_EXPOSURE_TEXT_EVALUATER_SYS_PROMPT_STR,
)

TWO_COMP_PROFILE_COMPARISON_MAIN_PROMPT = Prompt(
    name="RELEVANCY_TWO_COMP_COMPARISON_MAIN_PROMPT",
    template=TWO_COMP_PROFILE_COMPARISON_MAIN_PROMPT_STR,
)
TWO_COMP_PROFILE_COMPARISON_SYS_PROMPT = Prompt(
    name="RELEVANCY_TWO_COMP_COMPARISON_SYS_PROMPT",
    template=TWO_COMP_PROFILE_COMPARISON_SYS_PROMPT_STR,
)

TIEBREAKER_MAIN_PROMPT = Prompt(
    name="RELEVANCY_TIEBREAKER_MAIN_PROMPT",
    template=TIEBREAKER_MAIN_PROMPT_STR,
)
TIEBREAKER_SYS_PROMPT = Prompt(
    name="RELEVANCY_TIEBREAKER_SYS_PROMPT",
    template=TIEBREAKER_SYS_PROMPT_STR,
)

PROFILE_RUBRIC_GENERATION_MAIN_OBJ = Prompt(
    name="PROFILE_GENERATION_MAIN", template=PROFILE_RUBRIC_GENERATION_MAIN_PROMPT
)

PROFILE_RUBRIC_GENERATION_SYS_OBJ = Prompt(
    name="PROFILE_GENERATION_SYS", template=PROFILE_RUBRIC_GENERATION_SYS_PROMPT
)

PROFILE_PRIMER_SYS_OBJ = Prompt(name="PROFILE_PRIMER_SYS", template="")

RUBRIC_EVALUATION_MAIN_OBJ = Prompt(
    name="RUBRIC_EVALUATION_MAIN", template=RUBRIC_EVALUATION_MAIN_PROMPT
)

RUBRIC_EVALUATION_SYS_OBJ = Prompt(
    name="RUBRIC_EVALUATION_SYS", template=RUBRIC_EVALUATION_SYS_PROMPT
)

PROFILE_ADD_DIFF_SYS_PROMPT = Prompt(
    name="PROFILE_ADD_DIFF_SYS_PROMPT", template=PROFILE_ADD_DIFF_SYS_PROMPT_STR
)

PROFILE_ADD_DIFF_MAIN_PROMPT = Prompt(
    name="PROFILE_ADD_DIFF_MAIN_PROMPT", template=PROFILE_ADD_DIFF_MAIN_PROMPT_STR
)


PROFILE_REMOVE_DIFF_SYS_PROMPT = Prompt(
    name="PROFILE_REMOVE_DIFF_SYS_PROMPT", template=PROFILE_REMOVE_DIFF_SYS_PROMPT_STR
)

PROFILE_REMOVE_DIFF_MAIN_PROMPT = Prompt(
    name="PROFILE_REMOVE_DIFF_MAIN_PROMPT", template=PROFILE_REMOVE_DIFF_MAIN_PROMPT_STR
)

# Tool Descriptions

SIMPLE_PROFILE_DEFINITION = "the string must specify the exact property the desired companies have. For example, the string might be `companies which operate in Spain` or `companies which produce wingnuts used in Boeing airplanes`. If the client just expresses interest in companies related to a topic X in some way, the profile may also be `companies with recent Y that mention X` (where Y is a text type and X is the topic). The string passed into the profile argument MUST start with `companies which` and contain all information to understand why kind of companies we are looking for without any other context. In particular, do not include anaphoric language, do not say things `stocks like those` because we will not be able to interpret what `those` means without context, which we do not have here. If the client specifically mentions a relevant time range that defines the companies (i.e. a company which has undergone an event X within some time frame), you must mention that exact time range in the profile in addition to using the date range to collect texts. You must include all important details provided by the client in a single profile when possible, it is fine to include multiple conditions in (e.g. `Companies which produce wingnuts and which are based in Oklahoma`). It is extremely important to pass in a high quality string into the 'profile' argument as described earlier as this is what the stocks will be evaluated against. The more specific and detailed it is, the better the results will be."

SCORE_THRESHOLD_DEFINITION = "If the user has specified that they want to only see stocks in the results that score above a certain threshold then you must set score_threshold to the appropriate value (ie. if the user says only show me 3 stars or higher then score_threshold should be set to). By default score_threshold is set to 1 and will cut off any 0 scoring stocks. If the user wants to see every single stock ranked, then the score_threshold should be set to 0. The argument passed in to score_threshold must be an integer between 0 and 5! If the user says things like 'Show me strong matches' you should set the score threshold to 4 as to only show stocks with a score of 4 or higher."

FILTER_BY_PROFILE_DESCRIPTION = f"This function takes a list of stocks ('stocks'), a list of StockTexts about those stocks, and a profile. Neither of the lists can be empty! It uses an LLM to filter the list of stocks to a smaller list of stocks. If the user has requested a ranking or scoring of a list of stocks based on a profile match do not use this function under any circumstances, use the rank_stocks_by_profile tool instead! Additionally, you must never for any reason use this tool as a way to filter down a list of stocks to use as an input to the `rank_stocks_by_profile` tools as this will result in a catestrophic failure. Stocks in the input list are included in the output list if and only if the stock matches the provided profile based on the information in the corresponding texts for that stock. The texts passed to this tool must be the output of a text retrieval tool like `get_default_text_data_for_stocks` that produces List[StockText]. The text retrieval tool(s) you use must be called with the same stocks in the `stocks` list as the argument.  Do NOT pass the output of `get_news_articles_for_topics` or `get_news_and_web_pages_for_topics` to this tool, its Texts are not tagged by specific stocks and cannot be used in the tool. Very, very important: This function does NOT filter a text or a set of texts. Do not use it for this purpose. In most cases you think you want to use this function to filter texts, you actually want to use the summarize_text tool with the topic argument, which has a filtering effect. There are two datatypes the profile argument will accept. The first is as a string which must specify the exact property the desired companies have. If passing in a string into the profile argument, {SIMPLE_PROFILE_DEFINITION} Alternatively, if the user is interested in a broad topic like ('companies involved in wind energy') you may want to instead pass in a TopicProfiles object that is generated through the generate_profiles tool to get better results. This object will act as a more verbose alternative to the string option. {SCORE_THRESHOLD_DEFINITION} If you are filtering stocks, you will use this function, do not filter using filter_news_by_topic! For example, if the client asked for a list of stocks which had news about product releases in the last week, you would collect news for those stocks over the last week and call this function with the profile `companies with product release news in the last week`, you do not need to filter to press release news first! The text inputs to this function must be documents specifically about the stocks provided, the function used to acquire the data must take the same list of stock_ids as arguments. You must never, ever pass an empty list of texts to this function, and it almost never makes sense to pass one or a small fixed set, remember that your output is a list of stocks which satisfy a profile, not texts! Be careful about cases where the profile involve a company, e.g. 'looking for stocks which are suppliers to Apple`, Apple is part of the profile, it must NOT be passed to as the `stocks` argument, `stocks` must be a pool of stocks you want to search to find apple suppliers! If the client does not mention a specific kinds of texts to use for this filter (e.g. news, SEC filing, earnings call, custom document, etc.), just call the `get_default_text_data_for_stocks` tool before this one to get a list of all texts for the stocks. However, if the client specifically mentions a kind of text or kinds of texts to use in the filtering, then the list of texts passed in to this tool must include exactly those kinds of texts and no others. For example, if the client says `Give me stocks that mention buybacks in their earnings calls or sec filings`, then the `texts` argument to this function must ONLY include earnings calls summaries and sec filings, you must NOT pass all text data. I repeat: when the client does NOT specify the kind of documents that should be used, you must default to using the `get_default_text_data_for_stocks` tool for relevant stocks when you use this tool, but if the client does specify particular text types, no matter how many, you must pass only the kinds of documents that the client wants to this tool. Never just use company descriptions unless that is what the client asks for! The output of this function is a filtered list of stocks, not texts. Never use this function to answer a question about a single stock, use the answer question tool. Never use this function to filter stocks based purely on news sentiment, instead use the stock recommendation tool with filter=True and news_only=True. Never use this function when the client clearly wants to filter to a list of companies who all provide the same product, use the product or services tool for that, however this function should be used for other product-related filters (e.g. companies that use a product) or if they are looking to identify companies who carry out other operations (e.g. research) that cannot strictly be understood as product or services that are sold to consumers. You should avoid calling this tool with huge numbers of stocks/texts (more than 1000). Do any other stock filters in the request first when possible and (unlike the product filter tool) never, ever pass all stocks from a large stock universe like the r3k or the World Stock ETF to this tool unless the client demands it."


RANK_STOCKS_BY_PROFILE_DESCRIPTION = f"""You must invoke this function whenever a user expresses a desire to rank, score, or see what the top and/or bottom N companies are, with respect to some description of a specific type of company. If the user has expressed a desire to do this, then do not apply any filtering beyond possibly a sector filter via the sector_filter tool, and do not use any recommendation tool either such as get_stock_recommendations however under no circumstances are you allowed to filter by any profiles. This function must never be used alongside filter_stocks_by_profile_match nor is it ever allowed to take the outputs from filter_stocks_by_profile_match as its input. This function takes a list of stocks via the 'stocks' argument along with a list of texts associated with the input stocks via the 'stock_text' argument. Neither of these lists can be empty. The texts passed to this tool must be the output of a text retrieval tool such as `get_all_text_data_for_stocks` called with the same stocks in the `stocks` list as the argument. The purpose of this function is to rank and score a list of stocks based on the associated texts for each stock according to how strongly they match a the given company description. If a user has requested to rank a list of stocks by some common financial statistic like market cap, P/E ratio, returns, etc. must use the `transform_table` tool. This function must only be used when a user requests a ranking or requests of scoring for a list of stocks or get some top/bottom X best stocks, if the user has requested to filter a list of stocks you must use the `filter_stocks_by_profile_match` tool instead. The company description can be either passed in as a string through the 'profile' argument, {SIMPLE_PROFILE_DEFINITION} Alternatively, if the user is interested in a broad topic like ('companies involved in wind energy') you may want to instead pass in a TopicProfiles object that is generated through the generate_profiles tool to get better results. The output of this function returns the list of stocks sorted in descending order by the score they have been assigned, which is calculated based on how strongly each company fit the profile given. {SCORE_THRESHOLD_DEFINITION} Additionally, if the top N stocks are desired, a 'top_n' argument can be passed in, upon which this function will only return the 'top_n' stocks, also in descending order of relevancy/exposure. Only use this function when you want to rank stocks by some specific profile, do not use this function for any other purpose. Likewise, if the bottom M stocks are desired, a 'bottom_m' argument can be passed in, upon which this function will only return the 'bottom_m' stocks. If a user wants some top N and bottom M stocks to be returned you must specify those arguments when invoking this tool and the tool will return the top_n and bottom_m stocks. If this behavior is not desired by the user, do not pass in any value to either of these arugments and the full list of ranked stocks will be returned. It is extremely important to pass in a high quality string into the 'profile' argument as described earlier as this is what the stocks will be evaluated against. The more specific and detailed it is, the better the results will be.

If the user does not mention a specific kinds of texts to use for this filter (e.g. news, SEC filing, earnings call, custom document, etc.), just call the `get_default_text_data_for_stocks` tool before this one to get a list of all texts for the stocks. However, if the client specifically mentions a kind of text or kinds of texts to use in the filtering, then the list of texts passed in to this tool must include exactly those kinds of texts and no others. For example, if the client says `Give me stocks that mention buybacks in their earnings calls or sec filings`, then the `texts` argument to this function must ONLY include earnings calls summaries and sec filings, you must NOT pass all text data. I repeat: when the user does NOT specify the kind of documents that should be used, you must default to getting all documents for relevant stocks when you use this tool, but when they do, you must pass only the kinds of documents that the client wants to this tool. Never just use company descriptions unless that is what the client asks for! You should avoid calling this tool with huge numbers of stocks/texts (more than 1000). If a client has asked about fit to a given profile for all stocks within some large ETF or stock universe, you must filter the stocks down to the applicable stocks by using the sector_filter tool first, using an appropriate sector that well encapsulates the profile given to you! However you must not filter using the filter_stocks_by_profile_match as this will result in catestrophic failure."""

FILTER_AND_RANK_STOCKS_BY_PROFILE_DESCRIPTION = f"""This function is an dramatically improved version of both the rank_stocks_by_profile and filter_stocks_by_profile_match tools, and unifies the processes of both tools into one. Whenever there is a case where you have been instructed to use one of those tools you must call this tool instead for superior results. If you have been explicitly instructed to use either the rank_stocks_by_profile and/or filter_stocks_by_profile_match tools, your job is to invoke this tool instead.

This function takes a list of stocks ('stocks'), a list of StockTexts about those stocks, and a profile. Neither of the lists can be empty! The purpose of this tool is through the use of an LLM, it will filter and optionally rank the list of stocks to a smaller list of stocks relevant to the given profile. Stocks in the input list are included in the output list if and only if the stock matches the provided profile based on the information in the corresponding texts for that stock. The texts passed to this tool must be the output of a text retrieval tool like `get_default_text_data_for_stocks` that produces List[StockText]. The text retrieval tool(s) you use must be called with the same stocks in the `stocks` list as the argument.  Do NOT pass the output of `get_news_articles_for_topics` or `get_news_and_web_pages_for_topics` to this tool, its Texts are not tagged by specific stocks and cannot be used in the tool. Very, very important: This function does NOT filter a text or a set of texts. Do not use it for this purpose. In most cases you think you want to use this function to filter texts, you actually want to use the summarize_text tool with the topic argument, which has a filtering effect. There are two datatypes the profile argument will accept. The first is as a string which must specify the exact property the desired companies have. If passing in a string into the profile argument, {SIMPLE_PROFILE_DEFINITION} Alternatively, if the user is interested in a broad topic like ('companies involved in wind energy') you may want to instead pass in a TopicProfiles object that is generated through the generate_profiles tool to get better results. This object will act as a more verbose alternative to the string option.

If you are filtering or ranking stocks, you will use this function, do not filter using filter_news_by_topic! For example, if the client asked for a list of stocks which had news about product releases in the last week, you would collect news for those stocks over the last week and call this function with the profile `companies with product release news in the last week`, you do not need to filter to press release news first! The text inputs to this function must be documents specifically about the stocks provided, the function used to acquire the data must take the same list of stock_ids as arguments. You must never, ever pass an empty list of texts to this function, and it almost never makes sense to pass one or a small fixed set, remember that your output is a list of stocks which satisfy a profile, not texts! Be careful about cases where the profile involves a company, e.g. 'looking for stocks which are suppliers to Apple`, Apple is part of the profile, it must NOT be passed as the `stocks` argument, `stocks` must be a pool of stocks you want to search to find apple suppliers! If the client does not mention specific kinds of texts to use for this filter (e.g. news, SEC filing, earnings call, custom document, etc.), just call the `get_default_text_data_for_stocks` tool before this one to get a list of all texts for the stocks. However, if the client specifically mentions a kind of text or kinds of texts to use in the filtering, then the list of texts passed in to this tool must include exactly those kinds of texts and no others. For example, if the client says `Give me stocks that mention buybacks in their earnings calls or sec filings`, then the `texts` argument to this function must ONLY include earnings calls summaries and sec filings, you must NOT pass all text data. I repeat: when the client does NOT specify the kind of documents that should be used, you must default to using the `get_default_text_data_for_stocks` tool for relevant stocks when you use this tool, but if the client does specify particular text types, no matter how many, you must pass only the kinds of documents that the client wants to this tool. Never just use company descriptions unless that is what the client asks for!

This tool will, for each idea, use an LLM to filter the list of stocks to a smaller list of stocks. The 'complete_ranking' argument is a boolean which when set to True will instruct the tool to fully rank the stocks into distinct scores in addition to sorting them into levels. This should be set to True when the client has asked to see "the best" or "the worst" stocks/companies for a given profile, producing a sorted list of best to worst stocks given a profile with each stock having a unique floating point score between 0 to 5. If the client has simply asked to see companies related to a profile and has not made any mention of "ranking", "best"/"worst", "most exposed to" or other similar language, set complete_ranking to False, which will result in the tool assigning each stock an integer score from 0 to 5. {SCORE_THRESHOLD_DEFINITION}

There are two other arguments, 'top_n' and 'bottom_m'. These are optional arguments and should never have data passed in unless the client has explictly stated they want the top N and/or bottom M stocks to be returned in which case you should pass those values in as integers into 'top_n' and 'bottom_m' respectively. If the client makes no mention of "top" or "bottom" number of stocks they are interested in, then you must not pass in any value to either of these arugments. This is extremely important, DO NOT pass in an argument to top_n or bottom_m if the client has not explicitly asked for the top or bottom number of stocks. If you pass in a top_n when the user has only asked for "best stocks" then you will immediately be fired.

The output of this function is a list of stocks, not texts. Never use this function to answer a question about a single stock, use the answer question tool. Never use this function to filter stocks based purely on news sentiment, instead use the stock recommendation tool with filter=True and news_only=True. Never use this function when the client clearly wants to filter to a list of companies who all provide the same product, use the product or services tool for that, however this function should be used for other product-related filters (e.g. companies that use a product) or if they are looking to identify companies who carry out other operations (e.g. research) that cannot strictly be understood as product or services that are sold to consumers. You should avoid calling this tool with huge numbers of stocks/texts (more than 1000). Do any other stock filters in the request first when possible and (unlike the product filter tool) never, ever pass all stocks from a large stock universe like the r3k or the World Stock ETF to this tool unless the client demands it.
"""

# Idea Powered Tool Descriptions
PER_TOPIC_FILTER_BY_PROFILE_DESCRIPTION = f"""This tool is a variation of the filter_stocks_by_profile_match tool, extending it be run in combination with ideas generated from the brainstorm_ideas_from_text tool. You must invoke this function whenever a user expresses a desire to filter companies against the set of generated ideas you get from the brainstorm_ideas_from_text tool. This tool will, for each idea, use an LLM to filter the list of stocks to a smaller list of stocks. This tool also requires, in addition to ideas generated through brainstorm_ideas_from_text, profiles which are generated through the per_idea_generate_profiles tool. The list of ideas are passed in via the 'ideas' argument and the list of profiles are passed in via the 'profiles' argument. You will always call the per_idea_generate_profile tool as a separate call before you call this tool. Addtionally, this function takes in a list of stocks via the 'stocks' argument along with relevant texts for each stock via the 'texts' argument. {SCORE_THRESHOLD_DEFINITION} If the client does not mention a specific kinds of texts to use for this filter (e.g. news, SEC filing, earnings call, custom document, etc.), just call the `get_default_text_data_for_stocks` tool before this one to get a list of all texts for the stocks. However, if the client specifically mentions a kind of text or kinds of texts to use in the filtering, then the list of texts passed in to this tool must include exactly those kinds of texts and no others. For example, if the client says `Give me stocks that mention buybacks in their earnings calls or sec filings`, then the `texts` argument to this function must ONLY include earnings calls summaries and sec filings, you must NOT pass all text data. I repeat: when the client does NOT specify the kind of documents that should be used, you must default to using the `get_default_text_data_for_stocks` tool for relevant stocks when you use this tool, but if the client does specify particular text types, no matter how many, you must pass only the kinds of documents that the client wants to this tool. Never just use company descriptions unless that is what the client asks for! This tool will then iterate through each profile passed in, and filter the list of input stocks down to those relevant to that specific profile, forming a StockGroup object. The output of this tool is a StockGroups object, which will contain a list of StockGroup objects, one StockGroup for each profile passed in. It also includes an explanation for why each stock was included in each group, you should output the StockGroups object directly, do NOT run the per_stock_group_summarize_texts tool on the output of this tool unless the user explicitly asks for more information about the resulting stock groups, other than what they are and why they were chosen. Seriously, listen to me or you will be fired."""

PER_IDEA_FILTER_AND_RANK_STOCKS_BY_PROFILE_MATCH_DESCRIPTION = f"""This tool is an improved version of the per_idea_filter_stocks_by_profile_match tool which also supports stock ranking for a list of ideas. It is a variation of the filter_stocks_by_profile_match and filter_and_rank_stocks_by_profile tool, extending it be run in combination with ideas generated from the brainstorm_ideas_from_text tool. This is passed in through the 'ideas' argument. You must invoke this function whenever a user expresses a desire to filter companies against the set of generated ideas you get from the brainstorm_ideas_from_text tool. Whenever there is a case where you have been instructed to use one of those tools you must call this tool instead for superior results. If you have been explicitly instructed to use either the per_idea_filter_stocks_by_profile_match tools, your job is to invoke this tool instead. Additionally, whenever a user wants to generate a list of ideas and rank stocks across those ideas, you must also call this tool. The argument for 'complete_ranking', and 'score_threshold' must be handled in the same way they are in the filter_and_rank_stocks_by_profile tool, with the addition that these arguments will apply across all ideas. Similarly, 'top_n' and 'bottom_m' will work the same way they do in the filter_and_rank_stocks_by_profile tool, also apply across all ideas.

This tool also requires, in addition to ideas generated through brainstorm_ideas_from_text, profiles which are generated through the per_idea_generate_profiles tool. The list of ideas are passed in via the 'ideas' argument and the list of profiles are passed in via the 'profiles' argument. You will always call the per_idea_generate_profile tool as a separate call before you call this tool. Addtionally, this function takes in a list of stocks via the 'stocks' argument along with relevant texts for each stock via the 'stock_texts' argument in the same way as the filter_and_rank_stocks_by_profile tool. When the client does NOT specify the kind of documents that should be used, you must default to using the `get_default_text_data_for_stocks` tool for relevant stocks when you use this tool, but if the client does specify particular text types, no matter how many, you must pass only the kinds of documents that the client wants to this tool. Never just use company descriptions unless that is what the client asks for! This tool will then iterate through each profile passed in, and filter the list of input stocks down to those relevant to that specific profile, forming a StockGroup object. If the user has requested the stocks to be individually ranked and 'complete_ranking' has been set to True, the stocks in each StockGroup object will also be sorted and ranked from best to worst with unique scores. The output of this tool is a StockGroups object, which will contain a list of StockGroup objects, one StockGroup for each profile passed in. It also includes an explanation for why each stock was included in each group, you should output the StockGroups object directly, do NOT run the per_stock_group_summarize_texts tool on the output of this tool unless the user explicitly asks for more information about the resulting stock groups, other than what they are and why they were chosen. Seriously, listen to me or you will be fired.
"""

# Rubric Generation
PROFILE_RUBRIC_GENERATION_SYS_PROMPT_STR = """You are a highly skilled financial analyst. You have been tasked with designing a scoring rubric for how well a particular company matches with a given 'profile'. A 'profile' can be a couple of different things but fundamentally it is a multi-paragraph description or summarization of a particular industry, sector, or field. Your scoring rubric will be broken down into five distinct levels, 0 to 5. Where level 0 is any company that has absolutely zero relation to the 'profile' in question, level 1 is given to any company that barely matches the information given in the profile at all and a level 5 describes a company that is nearly a perfect match for the kind of company that would 'fit' what the profile describes. Design your rubric with the understanding that it will be used by an evaluator to assess individual companies to assign a level of fit to the profile you will be shown, however this evaluator will not have access to the actual profile. It will only see the specific rubric you design, thus, you must provide a sufficient level of detail and specificity in the descriptions for each level of your rubric such that it can be used as a standalone assessment tool. In any of your levels, do not make any mention of the word profile itself, instead making referencing to the details given to you within the profile. The rubric generated must be designed to act as a standalone assessment tool.

{additional_instruction}

You will structure your output as follows. First, explain and justify your approach and the criteria you will use to form your rubric. Next you will output on a new line the words "{rubric_delimiter}" followed by a line break. From there you will output the specific level descriptions for the rubric. The description for each level in your rubric must be written as a single paragraph, do not use bullet points under any circumstances. Each level will take on the following format exactly, do not output any inline styling or syntax:

Level N: Description

Ensure you always output five distinct levels in your rubric."""

PROFILE_RUBRIC_GENERATION_MAIN_PROMPT_STR = """Determine a scoring rubric for this by using information shown to you in the following profile '{profile}'. {additional_instruction}"""

PROFILE_RUBRIC_EXAMPLES_SYS_INSTRUCTION = """You will also be given will also be given a sampling of the set of stocks the rubric you generate will be used against. This sampling will contain a random set of stocks which may contain some stocks with a very strong fit to the profile and thus should score highly while other stocks included may be a weaker fit and would subsequently be scored lower. Each stock shown to you will also contain a summary containing information from that company relevant to the profile in question. Use this information to construct a high quality rubric that contains the depth and nuance required to sort stocks like the ones shown to you in the sampling into distinct levels. Keep in mind the sampling may not contain the best of the best or the worst of the worst, you must design your rubric to generalize beyond the sampling shown."""

PROFILE_RUBRIC_EXAMPLES_MAIN_INSTRUCTION = """Use the following sampling of stocks along with their stock summaries to help build your rubric. Each entry is seperated with '{delimiter}' and will contain the company name along with a summary:\n{samples}"""

RUBRIC_EVALUATION_MAIN_PROMPT = """The company in question is: {company_name}

Relation to the criteria: {reason}

Format your output as follows, a number indicating the level followed by ___ and a justification section explaining and justifying why you have chosen to assigned that particular level. Your justification must not make explicit reference to the specific level asigned though. Like so:

3___Here is some justification

The first thing you output must always be the number associated with the level selected. Do not include any inline styling or syntax, follow the format specified exactly. If you assign a level 0, there is no need to provide a justification but you must still output the ___."""

RUBRIC_EVALUATION_SYS_PROMPT = """Use the rubric below to assign a level for a given stock based on how well it fits the criteria. The rubric is shown below with a description for each level, ranging from 0 to 5:
{rubric_str}

Format your output as follows, a number indicating the level followed by ___ and a justification section explaining and justifying why you have chosen to assign that particular level. The first thing you output must always be the number associated with the level selected.
"""


PROFILE_RUBRIC_GENERATION_MAIN_OBJ = Prompt(
    name="PROFILE_RUBRIC_GENERATION_MAIN_PROMPT",
    template=PROFILE_RUBRIC_GENERATION_MAIN_PROMPT_STR,
)

PROFILE_RUBRIC_GENERATION_SYS_OBJ = Prompt(
    name="PROFILE_RUBRIC_GENERATION_SYS_PROMPT",
    template=PROFILE_RUBRIC_GENERATION_SYS_PROMPT_STR,
)

RUBRIC_EVALUATION_MAIN_OBJ = Prompt(
    name="RUBRIC_EVALUATION_MAIN", template=RUBRIC_EVALUATION_MAIN_PROMPT
)

RUBRIC_EVALUATION_SYS_OBJ = Prompt(
    name="RUBRIC_EVALUATION_SYS", template=RUBRIC_EVALUATION_SYS_PROMPT
)
